!function(t,e,i,o,n,s,d){var r=o.createElement,a=e.registerBlockType,l=d.BlockControls,w=n.ComboboxControl,g=s.withState,c=n.Toolbar,u=n.ToolbarButton,m=n.Placeholder,b=n.Spinner,p=i.__,v=function(t){var e="";return t.hasOwnProperty("responseJSON")?e=t.responseJSON.message:t.hasOwnProperty("responseText")&&(e=t.responseText),e};a("sowb/widget-block",{title:p("SiteOrigin Widget","so-widgets-bundle"),description:p("Select a SiteOrigin widget from the dropdown.","so-widgets-bundle"),icon:function(){return r("span",{className:"widget-icon so-widget-icon so-block-editor-icon"})},category:"widgets",keywords:[sowbBlockEditorAdmin.widgets.reduce((function(t,e){return t.length>0&&(t+=","),t+e.name}),"")],supports:{html:!1},attributes:{widgetClass:{type:"string"},widgetData:{type:"object"},widgetHtml:{type:"string"},widgetIcons:{type:"array"}},edit:g({editing:!1,formInitialized:!1,previewInitialized:!1,widgetFormHtml:"",widgetSettingsChanged:!1,widgetPreviewHtml:""})((function(t){function e(e=!1){wp.data.dispatch("core/editor").lockPostSaving(),jQuery.post({url:sowbBlockEditorAdmin.restUrl+"sowb/v1/widgets/previews",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",sowbBlockEditorAdmin.nonce)},data:{widgetClass:t.attributes.widgetClass,widgetData:e||(t.attributes.widgetData||{})}}).done((function(e){t.setState({widgetPreviewHtml:e.html,previewInitialized:!1}),t.setAttributes({widgetHtml:e.html,widgetIcons:e.icons}),wp.data.dispatch("core/editor").unlockPostSaving()})).fail((function(e){t.setState({widgetFormHtml:"<div>"+v(e)+"</div>"})}))}function i(){t.setState({editing:!1,previewInitialized:!1})}if(!t.editing&&t.attributes.widgetClass&&t.attributes.widgetData){var o=!t.loadingWidgets&&!t.editing&&!t.widgetPreviewHtml&&t.attributes.widgetClass&&t.attributes.widgetData;o&&(t.setAttributes({widgetHtml:null,widgetIcons:null}),e());var n=t.widgetPreviewHtml?t.widgetPreviewHtml:"";return[r(l,{key:"controls"},r(c,{label:p("Preview widget.","so-widgets-bundle")},r(u,{className:"components-icon-button components-toolbar__control",label:p("Edit widget.","so-widgets-bundle"),onClick:function(){t.setState({editing:!0,formInitialized:!1})},icon:"edit"}))),r("div",{key:"preview",className:"so-widget-preview-container"},o?r("div",{className:"so-widgets-spinner-container"},r("span",null,r(b))):r("div",{dangerouslySetInnerHTML:{__html:n},ref:function(){t.previewInitialized||(jQuery(window.sowb).trigger("setup_widgets",{preview:!0}),t.setState({previewInitialized:!0}))}}))]}var s=[];sowbBlockEditorAdmin.widgets&&(s=sowbBlockEditorAdmin.widgets.map((function(t){return{value:t.class,label:t.name}})));var d=t.attributes.widgetClass&&!t.widgetFormHtml;d&&jQuery.post({url:sowbBlockEditorAdmin.restUrl+"sowb/v1/widgets/forms",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",sowbBlockEditorAdmin.nonce)},data:{widgetClass:t.attributes.widgetClass,widgetData:t.attributes.widgetData}}).done((function(e){t.setState({widgetFormHtml:e})})).fail((function(e){t.setState({widgetFormHtml:"<div>"+v(e)+"</div>"})}));var a=t.widgetFormHtml?t.widgetFormHtml:"";return[!!a&&r(l,{key:"controls"},r(c,{label:p("Preview widget.","so-widgets-bundle")},r(u,{className:"components-icon-button components-toolbar__control",label:p("Preview widget.","so-widgets-bundle"),onClick:i,icon:"visibility"}))),r(m,{key:"placeholder",className:"so-widget-placeholder",label:p("SiteOrigin Widget","so-widgets-bundle"),instructions:p("Select the type of widget you want to use:","so-widgets-bundle")},t.loadingWidgets||d?r(b):r("div",{className:"so-widget-block-container"},r(w,{className:"so-widget-autocomplete-field",label:p("Widget type","so-widgets-bundle"),value:t.attributes.widgetClass,onFilterValueChange:function(t){},onChange:function(e){if(""!==e){if(t.widgetSettingsChanged&&!confirm(sowbBlockEditorAdmin.confirmChangeWidget))return!1;t.setAttributes({widgetClass:e,widgetData:null}),t.setState({editing:!0,widgetFormHtml:null,formInitialized:!1,widgetSettingsChanged:!1,widgetPreviewHtml:null,previewInitialized:!1})}},options:s}),r("div",{className:"so-widget-block-form-container",dangerouslySetInnerHTML:{__html:a},ref:function(o){var n=jQuery(o).find(".siteorigin-widget-form-main");n.length>0&&!t.formInitialized&&(n.siblings(".siteorigin-widget-preview").find("> a").on("click",(function(t){t.stopImmediatePropagation(),i()})),n.data("backupDisabled",!0),n.sowSetupForm(),t.attributes.widgetData?sowbForms.setWidgetFormValues(n,t.attributes.widgetData):t.setAttributes({widgetData:sowbForms.getWidgetFormValues(n)}),n.on("change",(function(){t.setState({widgetSettingsChanged:!0,widgetPreviewHtml:null,previewInitialized:!1});var i=sowbForms.getWidgetFormValues(n);t.setAttributes({widgetData:i}),e(i)})),t.setState({formInitialized:!0}))}})))]})),save:function(t){return null}})}(window.wp.editor,window.wp.blocks,window.wp.i18n,window.wp.element,window.wp.components,window.wp.compose,window.wp.blockEditor);