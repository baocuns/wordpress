!function(i){i(document).on("sowsetupformfield",".siteorigin-widget-field-type-multiple_media",(function(e){var t=i(this),d=t.find(".siteorigin-widget-input"),n=d.val().split(","),a=d.data("repeater");t.data("initialized")||(a&&(a.field=t.siblings(".siteorigin-widget-field-"+a.field).find(" > .siteorigin-widget-field-repeater"),a.addBtn=a.field.find("> .siteorigin-widget-field-repeater-add")),t.find(".button").on("click",(function(e){if(e.preventDefault(),void 0!==wp.media){var l=i(this),r=i(this).data("frame");if(r)return r.open(),!1;r=wp.media({title:l.data("choose"),library:{type:l.data("library").split(",").map((function(i){return i.trim()}))},multiple:!0,button:{text:l.data("update"),close:!1}}),a||r.on("open",(function(){if(n.length){var e=r.state().get("selection");i.each(n,(function(){e.add(wp.media.attachment(this))}))}})),l.data("frame",r),r.on("select",(function(){var e,l,f,o,s,m=[];i.each(r.state().get("selection").models,(function(){if(e=this.attributes,a)a.addBtn.trigger("click"),f=a.field.find("> .siteorigin-widget-field-repeater-items > .siteorigin-widget-field-repeater-item:last-of-type > .siteorigin-widget-field-repeater-item-form > .siteorigin-widget-field-"+a.setting),(s=f.find(".siteorigin-widget-input").not(".media-fallback-external")).val(e.id),f.find(".thumbnail").show();else{if(m.push(e.id),-1!=n.indexOf(e.id.toString()))return;t.find(".multiple-media-field-template .multiple-media-field-item").clone().appendTo(t.find(".multiple-media-field-items")),(f=t.find(".multiple-media-field-items .multiple-media-field-item").last()).attr("data-id",e.id)}(o=f.find(".thumbnail")).attr("title",e.title),f.find(".title").html(e.title),l=void 0!==e.sizes?void 0!==e.sizes.thumbnail?e.sizes.thumbnail.url:e.sizes.full.url:e.icon,o.attr("src",l),a&&s.trigger("change",{silent:!0})})),t.find(".multiple-media-field-items .multiple-media-field-item").each((function(){-1==m.indexOf(i(this).data("id"))&&i(this).remove()})),m.length?(n=m,d.val(m.join(","))):(n=[],d.val("")),r.close()})),r.open()}})),a||i(document).on("click",".siteorigin-widget-field-type-multiple_media a.media-remove-button",(function(e){e.preventDefault();var t=i(this).parent();n.splice(n.indexOf(t.data("id"))),d.val(n.join(",")),t.remove()})),t.data("initialized",!0))}))}(jQuery);